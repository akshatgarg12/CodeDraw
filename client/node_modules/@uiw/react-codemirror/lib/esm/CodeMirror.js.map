{"version":3,"sources":["../../src/CodeMirror.js"],"names":["CodeMirror","React","Component","PropTypes","ReactCodeMirror","props","codemirror","editor","renderCodeMirror","fromTextArea","textarea","options","eventDict","getEventHandleFromProps","Object","keys","forEach","event","on","value","width","height","setValue","setSize","prevProps","val","getValue","undefined","setOptions","mode","findModeByName","mime","name","JSON","stringify","setOption","toTextArea","propNames","eventHandle","filter","prop","test","ele","slice","replace","toLowerCase","instance","defaultProps","propTypes","string","object","oneOfType","number"],"mappings":"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","sourcesContent":["import CodeMirror from 'codemirror';\nimport 'codemirror/mode/meta';\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\n\nexport default class ReactCodeMirror extends Component {\n  constructor(props) {\n    super(props);\n    this.codemirror = null;\n    this.editor = null;\n  }\n\n  componentDidMount() {\n    this.renderCodeMirror();\n  }\n  renderCodeMirror() {\n    // 生成codemirror实例\n    this.editor = CodeMirror.fromTextArea(this.textarea, this.props.options);\n    // 获取CodeMirror用于获取其中的一些常量\n    this.codemirror = CodeMirror;\n    // 事件处理映射\n    const eventDict = this.getEventHandleFromProps();\n\n    Object.keys(eventDict).forEach((event) => {\n      this.editor.on(eventDict[event], this.props[event]);\n    });\n\n    const { value, width, height } = this.props;\n    // 初始化值\n    this.editor.setValue(value || '');\n\n    if (width || height) {\n      // 设置尺寸\n      this.editor.setSize(width, height);\n    }\n  }\n  async componentDidUpdate(prevProps) {\n    const val = this.editor.getValue();\n    const value = this.props.value;\n    if (value !== undefined && value !== prevProps.value && value !== val) {\n      this.editor.setValue(value);\n    }\n    const { width, height } = prevProps;\n    await this.setOptions(this.props.options);\n    if (width !== this.props.width || height !== this.props.height) {\n      this.editor.setSize(this.props.width, this.props.height);\n    }\n  }\n  // http://codemirror.net/doc/manual.html#config\n  async setOptions(options) {\n    if (typeof options === 'object') {\n      const mode = CodeMirror.findModeByName(options.mode);\n      if (mode && mode.mode) {\n        await import(`codemirror/mode/${mode.mode}/${mode.mode}.js`);\n      }\n      if (mode) {\n        options.mode = mode.mime;\n      }\n      Object.keys(options).forEach((name) => {\n        if (options[name] && JSON.stringify(options[name])) {\n          this.editor.setOption(name, options[name]);\n        }\n      });\n    }\n  }\n\n  componentWillUnmount() {\n    if (this.editor) {\n      this.editor.toTextArea();\n    }\n  }\n\n  // 将props中所有的事件处理函数映射并保存\n  getEventHandleFromProps() {\n    const propNames = Object.keys(this.props);\n    const eventHandle = propNames.filter((prop) => {\n      return /^on+/.test(prop);\n    });\n\n    const eventDict = {};\n    eventHandle.forEach((ele) => {\n      const name = ele.slice(2);\n      eventDict[ele] = name.replace(name[0],name[0].toLowerCase());\n    });\n\n    return eventDict;\n  }\n\n  render() {\n    return (\n      <textarea ref={(instance) => { this.textarea = instance; }} />\n    );\n  }\n}\n\nReactCodeMirror.defaultProps = {\n  value: '',\n  options: {},\n  width: '100%',\n  height: '100%',\n};\n\nReactCodeMirror.propTypes = {\n  value: PropTypes.string,\n  options: PropTypes.object,\n  width: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n  height: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n};\n"]}
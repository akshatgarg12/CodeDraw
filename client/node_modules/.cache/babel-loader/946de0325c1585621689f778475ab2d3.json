{"ast":null,"code":"/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @format\n * \n * @emails oncall+draft_js\n */\n'use strict';\n\nvar DOMObserver = require(\"./DOMObserver\");\n\nvar DraftModifier = require(\"./DraftModifier\");\n\nvar DraftOffsetKey = require(\"./DraftOffsetKey\");\n\nvar EditorState = require(\"./EditorState\");\n\nvar Keys = require(\"fbjs/lib/Keys\");\n\nvar UserAgent = require(\"fbjs/lib/UserAgent\");\n\nvar editOnSelect = require(\"./editOnSelect\");\n\nvar getContentEditableContainer = require(\"./getContentEditableContainer\");\n\nvar getDraftEditorSelection = require(\"./getDraftEditorSelection\");\n\nvar getEntityKeyForSelection = require(\"./getEntityKeyForSelection\");\n\nvar nullthrows = require(\"fbjs/lib/nullthrows\");\n\nvar isIE = UserAgent.isBrowser('IE');\n/**\n * Millisecond delay to allow `compositionstart` to fire again upon\n * `compositionend`.\n *\n * This is used for Korean input to ensure that typing can continue without\n * the editor trying to render too quickly. More specifically, Safari 7.1+\n * triggers `compositionstart` a little slower than Chrome/FF, which\n * leads to composed characters being resolved and re-render occurring\n * sooner than we want.\n */\n\nvar RESOLVE_DELAY = 20;\n/**\n * A handful of variables used to track the current composition and its\n * resolution status. These exist at the module level because it is not\n * possible to have compositions occurring in multiple editors simultaneously,\n * and it simplifies state management with respect to the DraftEditor component.\n */\n\nvar resolved = false;\nvar stillComposing = false;\nvar domObserver = null;\n\nfunction startDOMObserver(editor) {\n  if (!domObserver) {\n    domObserver = new DOMObserver(getContentEditableContainer(editor));\n    domObserver.start();\n  }\n}\n\nvar DraftEditorCompositionHandler = {\n  /**\n   * A `compositionstart` event has fired while we're still in composition\n   * mode. Continue the current composition session to prevent a re-render.\n   */\n  onCompositionStart: function onCompositionStart(editor) {\n    stillComposing = true;\n    startDOMObserver(editor);\n  },\n\n  /**\n   * Attempt to end the current composition session.\n   *\n   * Defer handling because browser will still insert the chars into active\n   * element after `compositionend`. If a `compositionstart` event fires\n   * before `resolveComposition` executes, our composition session will\n   * continue.\n   *\n   * The `resolved` flag is useful because certain IME interfaces fire the\n   * `compositionend` event multiple times, thus queueing up multiple attempts\n   * at handling the composition. Since handling the same composition event\n   * twice could break the DOM, we only use the first event. Example: Arabic\n   * Google Input Tools on Windows 8.1 fires `compositionend` three times.\n   */\n  onCompositionEnd: function onCompositionEnd(editor) {\n    resolved = false;\n    stillComposing = false;\n    setTimeout(function () {\n      if (!resolved) {\n        DraftEditorCompositionHandler.resolveComposition(editor);\n      }\n    }, RESOLVE_DELAY);\n  },\n  onSelect: editOnSelect,\n\n  /**\n   * In Safari, keydown events may fire when committing compositions. If\n   * the arrow keys are used to commit, prevent default so that the cursor\n   * doesn't move, otherwise it will jump back noticeably on re-render.\n   */\n  onKeyDown: function onKeyDown(editor, e) {\n    if (!stillComposing) {\n      // If a keydown event is received after compositionend but before the\n      // 20ms timer expires (ex: type option-E then backspace, or type A then\n      // backspace in 2-Set Korean), we should immediately resolve the\n      // composition and reinterpret the key press in edit mode.\n      DraftEditorCompositionHandler.resolveComposition(editor);\n\n      editor._onKeyDown(e);\n\n      return;\n    }\n\n    if (e.which === Keys.RIGHT || e.which === Keys.LEFT) {\n      e.preventDefault();\n    }\n  },\n\n  /**\n   * Keypress events may fire when committing compositions. In Firefox,\n   * pressing RETURN commits the composition and inserts extra newline\n   * characters that we do not want. `preventDefault` allows the composition\n   * to be committed while preventing the extra characters.\n   */\n  onKeyPress: function onKeyPress(_editor, e) {\n    if (e.which === Keys.RETURN) {\n      e.preventDefault();\n    }\n  },\n\n  /**\n   * Attempt to insert composed characters into the document.\n   *\n   * If we are still in a composition session, do nothing. Otherwise, insert\n   * the characters into the document and terminate the composition session.\n   *\n   * If no characters were composed -- for instance, the user\n   * deleted all composed characters and committed nothing new --\n   * force a re-render. We also re-render when the composition occurs\n   * at the beginning of a leaf, to ensure that if the browser has\n   * created a new text node for the composition, we will discard it.\n   *\n   * Resetting innerHTML will move focus to the beginning of the editor,\n   * so we update to force it back to the correct place.\n   */\n  resolveComposition: function resolveComposition(editor) {\n    if (stillComposing) {\n      return;\n    }\n\n    var mutations = nullthrows(domObserver).stopAndFlushMutations();\n    domObserver = null;\n    resolved = true;\n    var editorState = EditorState.set(editor._latestEditorState, {\n      inCompositionMode: false\n    });\n    editor.exitCurrentMode();\n\n    if (!mutations.size) {\n      editor.update(editorState);\n      return;\n    } // TODO, check if Facebook still needs this flag or if it could be removed.\n    // Since there can be multiple mutations providing a `composedChars` doesn't\n    // apply well on this new model.\n    // if (\n    //   gkx('draft_handlebeforeinput_composed_text') &&\n    //   editor.props.handleBeforeInput &&\n    //   isEventHandled(\n    //     editor.props.handleBeforeInput(\n    //       composedChars,\n    //       editorState,\n    //       event.timeStamp,\n    //     ),\n    //   )\n    // ) {\n    //   return;\n    // }\n\n\n    var contentState = editorState.getCurrentContent();\n    mutations.forEach(function (composedChars, offsetKey) {\n      var _DraftOffsetKey$decod = DraftOffsetKey.decode(offsetKey),\n          blockKey = _DraftOffsetKey$decod.blockKey,\n          decoratorKey = _DraftOffsetKey$decod.decoratorKey,\n          leafKey = _DraftOffsetKey$decod.leafKey;\n\n      var _editorState$getBlock = editorState.getBlockTree(blockKey).getIn([decoratorKey, 'leaves', leafKey]),\n          start = _editorState$getBlock.start,\n          end = _editorState$getBlock.end;\n\n      var replacementRange = editorState.getSelection().merge({\n        anchorKey: blockKey,\n        focusKey: blockKey,\n        anchorOffset: start,\n        focusOffset: end,\n        isBackward: false\n      });\n      var entityKey = getEntityKeyForSelection(contentState, replacementRange);\n      var currentStyle = contentState.getBlockForKey(blockKey).getInlineStyleAt(start);\n      contentState = DraftModifier.replaceText(contentState, replacementRange, composedChars, currentStyle, entityKey); // We need to update the editorState so the leaf node ranges are properly\n      // updated and multiple mutations are correctly applied.\n\n      editorState = EditorState.set(editorState, {\n        currentContent: contentState\n      });\n    }); // When we apply the text changes to the ContentState, the selection always\n    // goes to the end of the field, but it should just stay where it is\n    // after compositionEnd.\n\n    var documentSelection = getDraftEditorSelection(editorState, getContentEditableContainer(editor));\n    var compositionEndSelectionState = documentSelection.selectionState;\n    editor.restoreEditorDOM(); // See:\n    // - https://github.com/facebook/draft-js/issues/2093\n    // - https://github.com/facebook/draft-js/pull/2094\n    // Apply this fix only in IE for now. We can test it in\n    // other browsers in the future to ensure no regressions\n\n    var editorStateWithUpdatedSelection = isIE ? EditorState.forceSelection(editorState, compositionEndSelectionState) : EditorState.acceptSelection(editorState, compositionEndSelectionState);\n    editor.update(EditorState.push(editorStateWithUpdatedSelection, contentState, 'insert-characters'));\n  }\n};\nmodule.exports = DraftEditorCompositionHandler;","map":{"version":3,"sources":["/Users/akshatgarg/Documents/codedraw/node_modules/draft-js/lib/DraftEditorCompositionHandler.js"],"names":["DOMObserver","require","DraftModifier","DraftOffsetKey","EditorState","Keys","UserAgent","editOnSelect","getContentEditableContainer","getDraftEditorSelection","getEntityKeyForSelection","nullthrows","isIE","isBrowser","RESOLVE_DELAY","resolved","stillComposing","domObserver","startDOMObserver","editor","start","DraftEditorCompositionHandler","onCompositionStart","onCompositionEnd","setTimeout","resolveComposition","onSelect","onKeyDown","e","_onKeyDown","which","RIGHT","LEFT","preventDefault","onKeyPress","_editor","RETURN","mutations","stopAndFlushMutations","editorState","set","_latestEditorState","inCompositionMode","exitCurrentMode","size","update","contentState","getCurrentContent","forEach","composedChars","offsetKey","_DraftOffsetKey$decod","decode","blockKey","decoratorKey","leafKey","_editorState$getBlock","getBlockTree","getIn","end","replacementRange","getSelection","merge","anchorKey","focusKey","anchorOffset","focusOffset","isBackward","entityKey","currentStyle","getBlockForKey","getInlineStyleAt","replaceText","currentContent","documentSelection","compositionEndSelectionState","selectionState","restoreEditorDOM","editorStateWithUpdatedSelection","forceSelection","acceptSelection","push","module","exports"],"mappings":"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","sourcesContent":["/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @format\n * \n * @emails oncall+draft_js\n */\n'use strict';\n\nvar DOMObserver = require(\"./DOMObserver\");\n\nvar DraftModifier = require(\"./DraftModifier\");\n\nvar DraftOffsetKey = require(\"./DraftOffsetKey\");\n\nvar EditorState = require(\"./EditorState\");\n\nvar Keys = require(\"fbjs/lib/Keys\");\n\nvar UserAgent = require(\"fbjs/lib/UserAgent\");\n\nvar editOnSelect = require(\"./editOnSelect\");\n\nvar getContentEditableContainer = require(\"./getContentEditableContainer\");\n\nvar getDraftEditorSelection = require(\"./getDraftEditorSelection\");\n\nvar getEntityKeyForSelection = require(\"./getEntityKeyForSelection\");\n\nvar nullthrows = require(\"fbjs/lib/nullthrows\");\n\nvar isIE = UserAgent.isBrowser('IE');\n/**\n * Millisecond delay to allow `compositionstart` to fire again upon\n * `compositionend`.\n *\n * This is used for Korean input to ensure that typing can continue without\n * the editor trying to render too quickly. More specifically, Safari 7.1+\n * triggers `compositionstart` a little slower than Chrome/FF, which\n * leads to composed characters being resolved and re-render occurring\n * sooner than we want.\n */\n\nvar RESOLVE_DELAY = 20;\n/**\n * A handful of variables used to track the current composition and its\n * resolution status. These exist at the module level because it is not\n * possible to have compositions occurring in multiple editors simultaneously,\n * and it simplifies state management with respect to the DraftEditor component.\n */\n\nvar resolved = false;\nvar stillComposing = false;\nvar domObserver = null;\n\nfunction startDOMObserver(editor) {\n  if (!domObserver) {\n    domObserver = new DOMObserver(getContentEditableContainer(editor));\n    domObserver.start();\n  }\n}\n\nvar DraftEditorCompositionHandler = {\n  /**\n   * A `compositionstart` event has fired while we're still in composition\n   * mode. Continue the current composition session to prevent a re-render.\n   */\n  onCompositionStart: function onCompositionStart(editor) {\n    stillComposing = true;\n    startDOMObserver(editor);\n  },\n\n  /**\n   * Attempt to end the current composition session.\n   *\n   * Defer handling because browser will still insert the chars into active\n   * element after `compositionend`. If a `compositionstart` event fires\n   * before `resolveComposition` executes, our composition session will\n   * continue.\n   *\n   * The `resolved` flag is useful because certain IME interfaces fire the\n   * `compositionend` event multiple times, thus queueing up multiple attempts\n   * at handling the composition. Since handling the same composition event\n   * twice could break the DOM, we only use the first event. Example: Arabic\n   * Google Input Tools on Windows 8.1 fires `compositionend` three times.\n   */\n  onCompositionEnd: function onCompositionEnd(editor) {\n    resolved = false;\n    stillComposing = false;\n    setTimeout(function () {\n      if (!resolved) {\n        DraftEditorCompositionHandler.resolveComposition(editor);\n      }\n    }, RESOLVE_DELAY);\n  },\n  onSelect: editOnSelect,\n\n  /**\n   * In Safari, keydown events may fire when committing compositions. If\n   * the arrow keys are used to commit, prevent default so that the cursor\n   * doesn't move, otherwise it will jump back noticeably on re-render.\n   */\n  onKeyDown: function onKeyDown(editor, e) {\n    if (!stillComposing) {\n      // If a keydown event is received after compositionend but before the\n      // 20ms timer expires (ex: type option-E then backspace, or type A then\n      // backspace in 2-Set Korean), we should immediately resolve the\n      // composition and reinterpret the key press in edit mode.\n      DraftEditorCompositionHandler.resolveComposition(editor);\n\n      editor._onKeyDown(e);\n\n      return;\n    }\n\n    if (e.which === Keys.RIGHT || e.which === Keys.LEFT) {\n      e.preventDefault();\n    }\n  },\n\n  /**\n   * Keypress events may fire when committing compositions. In Firefox,\n   * pressing RETURN commits the composition and inserts extra newline\n   * characters that we do not want. `preventDefault` allows the composition\n   * to be committed while preventing the extra characters.\n   */\n  onKeyPress: function onKeyPress(_editor, e) {\n    if (e.which === Keys.RETURN) {\n      e.preventDefault();\n    }\n  },\n\n  /**\n   * Attempt to insert composed characters into the document.\n   *\n   * If we are still in a composition session, do nothing. Otherwise, insert\n   * the characters into the document and terminate the composition session.\n   *\n   * If no characters were composed -- for instance, the user\n   * deleted all composed characters and committed nothing new --\n   * force a re-render. We also re-render when the composition occurs\n   * at the beginning of a leaf, to ensure that if the browser has\n   * created a new text node for the composition, we will discard it.\n   *\n   * Resetting innerHTML will move focus to the beginning of the editor,\n   * so we update to force it back to the correct place.\n   */\n  resolveComposition: function resolveComposition(editor) {\n    if (stillComposing) {\n      return;\n    }\n\n    var mutations = nullthrows(domObserver).stopAndFlushMutations();\n    domObserver = null;\n    resolved = true;\n    var editorState = EditorState.set(editor._latestEditorState, {\n      inCompositionMode: false\n    });\n    editor.exitCurrentMode();\n\n    if (!mutations.size) {\n      editor.update(editorState);\n      return;\n    } // TODO, check if Facebook still needs this flag or if it could be removed.\n    // Since there can be multiple mutations providing a `composedChars` doesn't\n    // apply well on this new model.\n    // if (\n    //   gkx('draft_handlebeforeinput_composed_text') &&\n    //   editor.props.handleBeforeInput &&\n    //   isEventHandled(\n    //     editor.props.handleBeforeInput(\n    //       composedChars,\n    //       editorState,\n    //       event.timeStamp,\n    //     ),\n    //   )\n    // ) {\n    //   return;\n    // }\n\n\n    var contentState = editorState.getCurrentContent();\n    mutations.forEach(function (composedChars, offsetKey) {\n      var _DraftOffsetKey$decod = DraftOffsetKey.decode(offsetKey),\n          blockKey = _DraftOffsetKey$decod.blockKey,\n          decoratorKey = _DraftOffsetKey$decod.decoratorKey,\n          leafKey = _DraftOffsetKey$decod.leafKey;\n\n      var _editorState$getBlock = editorState.getBlockTree(blockKey).getIn([decoratorKey, 'leaves', leafKey]),\n          start = _editorState$getBlock.start,\n          end = _editorState$getBlock.end;\n\n      var replacementRange = editorState.getSelection().merge({\n        anchorKey: blockKey,\n        focusKey: blockKey,\n        anchorOffset: start,\n        focusOffset: end,\n        isBackward: false\n      });\n      var entityKey = getEntityKeyForSelection(contentState, replacementRange);\n      var currentStyle = contentState.getBlockForKey(blockKey).getInlineStyleAt(start);\n      contentState = DraftModifier.replaceText(contentState, replacementRange, composedChars, currentStyle, entityKey); // We need to update the editorState so the leaf node ranges are properly\n      // updated and multiple mutations are correctly applied.\n\n      editorState = EditorState.set(editorState, {\n        currentContent: contentState\n      });\n    }); // When we apply the text changes to the ContentState, the selection always\n    // goes to the end of the field, but it should just stay where it is\n    // after compositionEnd.\n\n    var documentSelection = getDraftEditorSelection(editorState, getContentEditableContainer(editor));\n    var compositionEndSelectionState = documentSelection.selectionState;\n    editor.restoreEditorDOM(); // See:\n    // - https://github.com/facebook/draft-js/issues/2093\n    // - https://github.com/facebook/draft-js/pull/2094\n    // Apply this fix only in IE for now. We can test it in\n    // other browsers in the future to ensure no regressions\n\n    var editorStateWithUpdatedSelection = isIE ? EditorState.forceSelection(editorState, compositionEndSelectionState) : EditorState.acceptSelection(editorState, compositionEndSelectionState);\n    editor.update(EditorState.push(editorStateWithUpdatedSelection, contentState, 'insert-characters'));\n  }\n};\nmodule.exports = DraftEditorCompositionHandler;"]},"metadata":{},"sourceType":"script"}